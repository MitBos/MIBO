@*
    ApiResultPanel.razor
    --------------------
    Purpose:
    Displays the result of running an integration:
    - Raw response JSON
    - Optional mapped JSON
    - Execution logs

    Parameters:
    - ApiResult: Holds metadata (success, status code, raw JSON).
    - MappedJson: The transformed JSON (if mapping was applied).
*@

@using MIBO.Models

@if (ApiResult != null)
{
    <div class="panel mt-4">
        <div class="panel-header">
            <div>
                <div class="panel-title">Source API result</div>
                <div class="panel-subtitle">Raw and mapped responses.</div>
            </div>
        </div>

        <p><strong>Success:</strong> @ApiResult.Success</p>
        <p><strong>Status code:</strong> @ApiResult.StatusCode</p>

        <h3 class="section-heading">Raw response</h3>
        <pre>@ApiResult.ResponseBody</pre>

        @if (!string.IsNullOrWhiteSpace(MappedJson))
        {
            <h3 class="section-heading">Mapped output</h3>
            <pre>@MappedJson</pre>
        }

        @if (ApiResult.Logs?.Count > 0)
        {
            <h3 class="section-heading">Logs</h3>
            <pre>@string.Join("\n", ApiResult.Logs)</pre>
        }
    </div>
}

@code {
    [Parameter] public ApiCallResult? ApiResult { get; set; }

    /// <summary>
    /// Contains the mapped JSON output after a run, if mapping is applied.
    /// </summary>
    [Parameter] public string? MappedJson { get; set; }
}
